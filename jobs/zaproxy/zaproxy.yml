stages:
  - dynamic_tests

job_name:
    image: owasp/zap2docker-stable:2.9.0
    stage: dynamic_tests
    variables:
      ZAP_SCANNERS: ""
      ZAP_CONTEXT: ""
      ZAP_TARGET: "http://app"
    script:
      - if [ ! -z ${ZAP_CONTEXT} ]; then
      -   zap-cli context import ${ZAP_CONTEXT}
      -   if [ ! -z ${ZAP_SCANNERS}]; then
      -     zap-cli quick-scan -s $ {ZAP_SCANNERS} --context-name ${ZAP_CONTEXT} --self-contained --start-options '-config api.disablekey=true' ${ZAP_TARGET}
      -   else
      -     zap-cli quick-scan --context-name ${ZAP_CONTEXT} --self-contained --start-options '-config api.disablekey=true' ${ZAP_TARGET}
      -   fi
      - else
      -   if [ ! -z ${ZAP_SCANNERS}]; then
      -     zap-cli quick-scan -s $ {ZAP_SCANNERS} --self-contained --start-options '-config api.disablekey=true' ${ZAP_TARGET} 
      -   else
      -     zap-cli quick-scan --self-contained --start-options '-config api.disablekey=true' ${ZAP_TARGET}
      -   fi
      - fi
      - zap-cli report -o zap-report.html -f html
    artifacts:
      expose_as: "Zaproxy scan report"
      paths:
        - zap-report.html
